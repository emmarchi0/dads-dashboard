<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#e5e7eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Michael's Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== BASE ===== */
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #d6d9e0;
            color: #1f2937;
            min-height: 100vh;
            line-height: 1.6;
        }

        a { color: inherit; text-decoration: none; }

        /* ===== TICKER TAPE ===== */
        .ticker-wrapper {
            border-bottom: 1px solid #c9cdd4;
            position: sticky;
            top: 0;
            z-index: 100;
            background: #eceef1;
        }

        /* ===== HEADER ===== */
        .header {
            background: #eceef1;
            border-bottom: 1px solid #c9cdd4;
            padding: 18px 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .header-center {
            text-align: center;
        }

        .header h1 {
            font-size: 1.6rem;
            font-weight: 700;
            color: #1f2937;
        }

        .header-meta {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            margin-top: 6px;
            font-size: 0.8rem;
            color: #6b7280;
        }

        .created-by {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.78rem;
            color: #6b7280;
            font-weight: 500;
        }

        .created-by img {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #c9cdd4;
        }

        .refresh-btn {
            background: #4b5563;
            border: none;
            color: #ffffff;
            padding: 6px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.78rem;
            font-family: inherit;
            font-weight: 500;
            transition: all 0.2s;
        }

        .refresh-btn:hover { background: #374151; }

        /* ===== TAB BAR ===== */
        .tab-bar {
            display: flex;
            gap: 4px;
            padding: 10px 24px;
            background: #eceef1;
            border-bottom: 1px solid #c9cdd4;
            overflow-x: auto;
            position: sticky;
            top: 46px;
            z-index: 99;
        }

        .tab-bar::-webkit-scrollbar { display: none; }

        .tab {
            padding: 9px 22px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 500;
            font-size: 0.88rem;
            border-radius: 10px;
            cursor: pointer;
            white-space: nowrap;
            font-family: inherit;
            transition: all 0.2s;
        }

        .tab:hover { background: #dfe1e6; color: #374151; }
        .tab.active { background: #4b5563; color: #ffffff; }

        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
            max-width: 1300px;
            margin: 0 auto;
            padding: 24px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active { display: block; }

        /* ===== CARDS ===== */
        .card {
            background: #f0f1f4;
            border-radius: 12px;
            border: 1px solid #c9cdd4;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 20px;
            border-bottom: 1px solid #c9cdd4;
            background: #e4e6ea;
        }

        .card-header h2 { font-size: 1rem; font-weight: 600; color: #1f2937; }

        .accent {
            width: 4px;
            height: 20px;
            border-radius: 2px;
        }

        .card-body { padding: 20px; }

        /* ===== SECTION ACCENTS ===== */
        .accent-pentair { background: #0069AA; }
        .accent-netapp { background: #0067C5; }
        .accent-economy { background: #059669; }
        .accent-politics { background: #7c3aed; }
        .accent-news { background: #ea580c; }
        .accent-warriors { background: #1d428a; }
        .accent-niners { background: #aa0000; }

        /* ===== TAB TITLES ===== */
        .tab-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }

        .section-subtitle {
            font-size: 1.05rem;
            font-weight: 600;
            color: #1f2937;
            margin: 28px 0 14px;
        }

        /* ===== WIDGET CONTAINERS ===== */
        .widget-container {
            height: 400px;
            position: relative;
        }

        .widget-container.medium { height: 450px; }

        .tradingview-widget-container { height: 100%; }

        /* ===== STOCK GRID ON HOME ===== */
        .stock-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 24px;
        }

        /* ===== NEWS GRID ===== */
        .news-grid-2col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 14px;
        }

        .news-grid-1col {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .news-card {
            display: flex;
            gap: 14px;
            padding: 14px;
            border-radius: 10px;
            background: #eceef1;
            border: 1px solid #c9cdd4;
            transition: all 0.2s;
            cursor: pointer;
            align-items: flex-start;
        }

        .news-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #9ca3af;
            transform: translateY(-2px);
        }

        .news-thumb {
            width: 110px;
            height: 74px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
            background: #d6d9e0;
        }

        .news-card-text {
            flex: 1;
            min-width: 0;
        }

        .news-title {
            font-size: 0.88rem;
            font-weight: 500;
            line-height: 1.4;
            color: #1f2937;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .news-meta .source { color: #6b7280; font-weight: 500; }

        /* ===== SPORTS ===== */
        .team-banner {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 24px;
            background: #eceef1;
            border: 1px solid #c9cdd4;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        }

        .team-banner.warriors-banner { border-left: 5px solid #1d428a; }
        .team-banner.niners-banner { border-left: 5px solid #aa0000; }

        .team-logo { width: 72px; height: 72px; object-fit: contain; }

        .team-name { font-size: 1.1rem; font-weight: 700; color: #1f2937; }
        .team-record { font-size: 1.8rem; font-weight: 700; color: #1f2937; }
        .team-standing { font-size: 0.85rem; color: #6b7280; margin-top: 2px; }

        .sports-grid {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 24px;
        }

        .section-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #9ca3af;
            margin-bottom: 10px;
        }

        .game-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            border-radius: 8px;
            background: #e4e6ea;
            border: 1px solid #d1d5db;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .game-item.win { border-left: 3px solid #059669; }
        .game-item.loss { border-left: 3px solid #dc2626; }

        .game-item .result { font-weight: 600; }
        .game-item .result.win-text { color: #059669; }
        .game-item .result.loss-text { color: #dc2626; }

        .game-date-label { font-size: 0.75rem; color: #9ca3af; }

        .next-game-card {
            background: #e4e6ea;
            border: 1px solid #c9cdd4;
            border-radius: 10px;
            padding: 14px 16px;
            margin-bottom: 16px;
        }

        .next-game-card .label {
            font-size: 0.7rem; color: #4b5563; font-weight: 600;
            text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 4px;
        }

        .next-game-card .matchup { font-size: 0.95rem; font-weight: 600; color: #1f2937; }
        .next-game-card .datetime { font-size: 0.8rem; color: #6b7280; margin-top: 4px; }

        /* ESPN article cards with images */
        .espn-card {
            display: flex;
            gap: 14px;
            align-items: flex-start;
        }

        .espn-thumb {
            width: 100px;
            height: 68px;
            object-fit: cover;
            border-radius: 8px;
            flex-shrink: 0;
            background: #d6d9e0;
        }

        /* ===== STATES ===== */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #9ca3af;
        }

        .loading-dot {
            width: 8px; height: 8px; border-radius: 50%; background: #9ca3af;
            margin: 0 4px; animation: loadingDot 1.4s infinite ease-in-out both;
        }

        .loading-dot:nth-child(1) { animation-delay: -0.32s; }
        .loading-dot:nth-child(2) { animation-delay: -0.16s; }

        @keyframes loadingDot {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.4; }
            40% { transform: scale(1); opacity: 1; }
        }

        .error-state { text-align: center; padding: 30px; color: #9ca3af; }
        .error-state a { color: #4b5563; display: inline-block; margin-top: 8px; }

        .error-state button {
            margin-top: 10px; background: #4b5563; border: none; color: #ffffff;
            padding: 8px 20px; border-radius: 8px; cursor: pointer;
            font-family: inherit; font-size: 0.85rem;
        }

        .fade-in { animation: fadeIn 0.35s ease-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== SCROLLBAR ===== */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 3px; }

        /* ===== FOOTER ===== */
        .footer {
            text-align: center; padding: 24px; color: #6b7280; font-size: 0.75rem;
            border-top: 1px solid #c9cdd4; background: #eceef1;
        }
        .footer a { color: #6b7280; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 900px) {
            .header { flex-direction: column; gap: 10px; }
            .created-by { position: static; transform: none; }
            .header h1 { font-size: 1.3rem; }
            .tab-bar { padding: 8px 12px; }
            .tab { padding: 8px 16px; font-size: 0.82rem; }
            .tab-content { padding: 16px; }
            .stock-grid { grid-template-columns: 1fr; }
            .news-grid-2col { grid-template-columns: 1fr; }
            .sports-grid { grid-template-columns: 1fr; }
            .widget-container { height: 320px; }
            .team-record { font-size: 1.4rem; }
            .team-banner { flex-direction: column; text-align: center; }
            .news-thumb { width: 90px; height: 60px; }
        }
    </style>
</head>
<body>

    <!-- ===== TICKER TAPE ===== -->
    <div class="ticker-wrapper">
        <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
            {
                "symbols": [
                    {"proName": "NYSE:PNR", "title": "Pentair"},
                    {"proName": "NASDAQ:NTAP", "title": "NetApp"},
                    {"proName": "FOREXCOM:SPXUSD", "title": "S&P 500"},
                    {"proName": "FOREXCOM:NSXUSD", "title": "Nasdaq 100"},
                    {"proName": "FOREXCOM:DJI", "title": "Dow 30"},
                    {"proName": "TVC:GOLD", "title": "Gold"},
                    {"proName": "TVC:USOIL", "title": "Crude Oil"},
                    {"proName": "BITSTAMP:BTCUSD", "title": "Bitcoin"}
                ],
                "showSymbolLogo": true,
                "isTransparent": true,
                "displayMode": "adaptive",
                "colorTheme": "light",
                "locale": "en"
            }
            </script>
        </div>
    </div>

    <!-- ===== HEADER ===== -->
    <header class="header">
        <div class="header-center">
            <h1>Hello Michael</h1>
            <div class="header-meta">
                <span>Updated: <span id="lastUpdated">...</span></span>
                <button class="refresh-btn" onclick="refreshAll()">Refresh</button>
            </div>
        </div>
        <div class="created-by">
            <span>Created by:</span>
            <img src="creator.png" alt="Eric">
        </div>
    </header>

    <!-- ===== TAB BAR ===== -->
    <nav class="tab-bar">
        <button class="tab active" data-tab="home" onclick="switchTab('home')">Home</button>
        <button class="tab" data-tab="politics" onclick="switchTab('politics')">Politics</button>
        <button class="tab" data-tab="economy" onclick="switchTab('economy')">Economy</button>
        <button class="tab" data-tab="news" onclick="switchTab('news')">News</button>
        <button class="tab" data-tab="warriors" onclick="switchTab('warriors')">Warriors</button>
        <button class="tab" data-tab="niners" onclick="switchTab('niners')">49ers</button>
        <button class="tab" data-tab="requests" onclick="switchTab('requests')">Requests</button>
    </nav>

    <!-- ===== TAB: HOME ===== -->
    <div class="tab-content active" id="tab-home">
        <div class="stock-grid">
            <section class="card">
                <div class="card-header">
                    <div class="accent accent-pentair"></div>
                    <h2>Pentair (PNR)</h2>
                </div>
                <div class="widget-container">
                    <div class="tradingview-widget-container">
                        <div class="tradingview-widget-container__widget"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js" async>
                        {
                            "symbols": [["Pentair", "NYSE:PNR|12M"]],
                            "chartOnly": false,
                            "width": "100%",
                            "height": "100%",
                            "locale": "en",
                            "colorTheme": "light",
                            "autosize": true,
                            "showVolume": false,
                            "showMA": false,
                            "hideDateRanges": false,
                            "hideMarketStatus": false,
                            "hideSymbolLogo": false,
                            "scalePosition": "right",
                            "scaleMode": "Normal",
                            "noTimeScale": false,
                            "valuesTracking": "1",
                            "changeMode": "price-and-percent",
                            "chartType": "area",
                            "lineWidth": 2,
                            "lineColor": "#0069AA",
                            "topColor": "rgba(0, 105, 170, 0.15)",
                            "bottomColor": "rgba(0, 105, 170, 0.0)",
                            "dateRanges": ["1d|1", "1m|30", "3m|60", "12m|1D", "60m|1W", "all|1M"]
                        }
                        </script>
                    </div>
                </div>
            </section>
            <section class="card">
                <div class="card-header">
                    <div class="accent accent-netapp"></div>
                    <h2>NetApp (NTAP)</h2>
                </div>
                <div class="widget-container">
                    <div class="tradingview-widget-container">
                        <div class="tradingview-widget-container__widget"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-symbol-overview.js" async>
                        {
                            "symbols": [["NetApp", "NASDAQ:NTAP|12M"]],
                            "chartOnly": false,
                            "width": "100%",
                            "height": "100%",
                            "locale": "en",
                            "colorTheme": "light",
                            "autosize": true,
                            "showVolume": false,
                            "showMA": false,
                            "hideDateRanges": false,
                            "hideMarketStatus": false,
                            "hideSymbolLogo": false,
                            "scalePosition": "right",
                            "scaleMode": "Normal",
                            "noTimeScale": false,
                            "valuesTracking": "1",
                            "changeMode": "price-and-percent",
                            "chartType": "area",
                            "lineWidth": 2,
                            "lineColor": "#0067C5",
                            "topColor": "rgba(0, 103, 197, 0.15)",
                            "bottomColor": "rgba(0, 103, 197, 0.0)",
                            "dateRanges": ["1d|1", "1m|30", "3m|60", "12m|1D", "60m|1W", "all|1M"]
                        }
                        </script>
                    </div>
                </div>
            </section>
        </div>

        <div style="display:grid; grid-template-columns:1fr 1fr; gap:16px;">
            <div class="card">
                <div class="card-header">
                    <div class="accent accent-warriors"></div>
                    <h2>Warriors Quick Look</h2>
                </div>
                <div class="card-body" id="home-warriors-quick">
                    <div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="accent accent-niners"></div>
                    <h2>49ers Quick Look</h2>
                </div>
                <div class="card-body" id="home-niners-quick">
                    <div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== TAB: POLITICS ===== -->
    <div class="tab-content" id="tab-politics">
        <h2 class="tab-title">Political News</h2>
        <div id="politics-feed" class="news-grid-2col">
            <div class="loading" style="grid-column:span 2;"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
        </div>
    </div>

    <!-- ===== TAB: ECONOMY ===== -->
    <div class="tab-content" id="tab-economy">
        <h2 class="tab-title">Economy &amp; Markets</h2>
        <section class="card" style="margin-bottom:24px;">
            <div class="card-header">
                <div class="accent accent-economy"></div>
                <h2>Market Overview</h2>
            </div>
            <div class="widget-container medium" id="economy-widget-area">
                <div class="loading" style="height:100%;"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
            </div>
        </section>
        <h3 class="section-subtitle">Economy Headlines</h3>
        <div id="economy-feed" class="news-grid-2col">
            <div class="loading" style="grid-column:span 2;"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
        </div>
    </div>

    <!-- ===== TAB: NEWS ===== -->
    <div class="tab-content" id="tab-news">
        <h2 class="tab-title">Top Stories</h2>
        <div id="news-feed" class="news-grid-2col">
            <div class="loading" style="grid-column:span 2;"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
        </div>
    </div>

    <!-- ===== TAB: WARRIORS ===== -->
    <div class="tab-content" id="tab-warriors">
        <div id="warriors-data">
            <div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
        </div>
    </div>

    <!-- ===== TAB: 49ERS ===== -->
    <div class="tab-content" id="tab-niners">
        <div id="niners-data">
            <div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
        </div>
    </div>

    <!-- ===== TAB: REQUESTS ===== -->
    <div class="tab-content" id="tab-requests">
        <h2 class="tab-title">Requests</h2>
        <div class="card" style="max-width:700px;">
            <div class="card-header">
                <div class="accent" style="background:#4b5563;"></div>
                <h2>Got an idea?</h2>
            </div>
            <div class="card-body">
                <p style="font-size:0.95rem;color:#4b5563;line-height:1.7;margin-bottom:20px;">
                    If dad has an idea to be added to the website, Eric may add it when he gets a chance!
                </p>
                <div style="background:#e4e6ea;border-radius:10px;padding:16px;border:1px solid #c9cdd4;">
                    <div style="font-size:0.75rem;font-weight:600;text-transform:uppercase;letter-spacing:0.05em;color:#9ca3af;margin-bottom:10px;">How it works</div>
                    <ul style="list-style:none;font-size:0.88rem;color:#4b5563;">
                        <li style="padding:6px 0;">1. Think of something you'd like to see on the dashboard</li>
                        <li style="padding:6px 0;">2. Tell Eric about it</li>
                        <li style="padding:6px 0;">3. Eric will work his magic when he gets a chance</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== FOOTER ===== -->
    <footer class="footer">
        Market data by <a href="https://www.tradingview.com" target="_blank" rel="noopener">TradingView</a>
        &bull; Sports data by ESPN
        &bull; News via Google News
        &bull; Auto-refreshes every 5 min
    </footer>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
        // ===== CONFIG =====
        var CONFIG = {
            REFRESH_INTERVAL: 5 * 60 * 1000,
            NEWS_COUNT: 10,
            ESPN_BASE: 'https://site.api.espn.com/apis/site/v2/sports',
            RSS2JSON: 'https://api.rss2json.com/v1/api.json',
            ALLORIGINS: 'https://api.allorigins.win/get'
        };

        var economyWidgetLoaded = false;

        // ===== TAB SWITCHING =====
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            document.getElementById('tab-' + tabName).classList.add('active');
            document.querySelector('[data-tab="' + tabName + '"]').classList.add('active');

            if (tabName === 'economy' && !economyWidgetLoaded) {
                loadEconomyWidget();
            }

            setTimeout(function() { window.dispatchEvent(new Event('resize')); }, 200);
        }

        // ===== HELPERS =====
        function sanitize(str) {
            var div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function timeAgo(dateStr) {
            var now = new Date();
            var date = new Date(dateStr);
            var diff = Math.floor((now - date) / 1000);
            if (isNaN(diff) || diff < 0) return '';
            if (diff < 60) return 'just now';
            if (diff < 3600) return Math.floor(diff / 60) + 'm ago';
            if (diff < 86400) return Math.floor(diff / 3600) + 'h ago';
            if (diff < 604800) return Math.floor(diff / 86400) + 'd ago';
            return date.toLocaleDateString();
        }

        function formatGameDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
        }

        function formatGameTime(dateStr) {
            return new Date(dateStr).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }

        function extractImage(html) {
            if (!html) return '';
            var m = html.match(/<img[^>]+src=["']([^"']+)["']/i);
            return m ? m[1] : '';
        }

        function loadingHTML() {
            return '<div class="loading"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>';
        }

        function updateTimestamp() {
            document.getElementById('lastUpdated').textContent =
                new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }

        // ===== ECONOMY WIDGET (lazy load) =====
        function loadEconomyWidget() {
            economyWidgetLoaded = true;
            var area = document.getElementById('economy-widget-area');
            area.innerHTML = '';

            var wc = document.createElement('div');
            wc.className = 'tradingview-widget-container';
            wc.style.height = '100%';

            var wd = document.createElement('div');
            wd.className = 'tradingview-widget-container__widget';
            wc.appendChild(wd);

            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-market-overview.js';
            script.async = true;
            script.text = JSON.stringify({
                "colorTheme": "light",
                "dateRange": "12M",
                "showChart": true,
                "locale": "en",
                "isTransparent": true,
                "showSymbolLogo": true,
                "showFloatingTooltip": true,
                "width": "100%",
                "height": "100%",
                "tabs": [
                    {
                        "title": "Indices",
                        "symbols": [
                            {"s": "FOREXCOM:SPXUSD", "d": "S&P 500"},
                            {"s": "FOREXCOM:NSXUSD", "d": "Nasdaq 100"},
                            {"s": "FOREXCOM:DJI", "d": "Dow 30"}
                        ]
                    },
                    {
                        "title": "Commodities",
                        "symbols": [
                            {"s": "TVC:GOLD", "d": "Gold"},
                            {"s": "TVC:SILVER", "d": "Silver"},
                            {"s": "TVC:USOIL", "d": "Crude Oil"}
                        ]
                    }
                ]
            });
            wc.appendChild(script);
            area.appendChild(wc);
        }

        // ===== NEWS FETCHING =====
        async function fetchNews(query, containerId, retryFnName, fallbackUrl) {
            var container = document.getElementById(containerId);

            try {
                var rssUrl = 'https://news.google.com/rss/search?q=' + encodeURIComponent(query) + '&hl=en-US&gl=US&ceid=US:en';
                var res = await fetch(CONFIG.RSS2JSON + '?rss_url=' + encodeURIComponent(rssUrl));
                var data = await res.json();

                if (data.status === 'ok' && data.items && data.items.length > 0) {
                    renderNewsCards(container, data.items);
                    return;
                }
                throw new Error('no data');
            } catch (e1) {
                try {
                    var rssUrl2 = 'https://news.google.com/rss/search?q=' + encodeURIComponent(query) + '&hl=en-US&gl=US&ceid=US:en';
                    var res2 = await fetch(CONFIG.ALLORIGINS + '?url=' + encodeURIComponent(rssUrl2));
                    var data2 = await res2.json();
                    var parser = new DOMParser();
                    var xml = parser.parseFromString(data2.contents, 'text/xml');
                    var items = xml.querySelectorAll('item');

                    if (items.length > 0) {
                        var parsed = Array.from(items).slice(0, CONFIG.NEWS_COUNT).map(function(item) {
                            var mediaEl = item.getElementsByTagName('media:content')[0];
                            var enclosureEl = item.getElementsByTagName('enclosure')[0];
                            var thumb = '';
                            if (mediaEl) thumb = mediaEl.getAttribute('url') || '';
                            if (!thumb && enclosureEl) thumb = enclosureEl.getAttribute('url') || '';
                            return {
                                title: item.querySelector('title') ? item.querySelector('title').textContent : '',
                                link: item.querySelector('link') ? item.querySelector('link').textContent : '#',
                                pubDate: item.querySelector('pubDate') ? item.querySelector('pubDate').textContent : '',
                                author: item.querySelector('source') ? item.querySelector('source').textContent : 'News',
                                thumbnail: thumb
                            };
                        });
                        renderNewsCards(container, parsed);
                        return;
                    }
                    throw new Error('no items');
                } catch (e2) {
                    container.innerHTML =
                        '<div class="error-state" style="grid-column:span 2;">' +
                        '<p>Unable to load news</p>' +
                        '<a href="' + sanitize(fallbackUrl) + '" target="_blank" rel="noopener">Open on Google News &rarr;</a><br>' +
                        '<button onclick="' + retryFnName + '()">Try Again</button>' +
                        '</div>';
                }
            }
        }

        function renderNewsCards(container, items) {
            container.innerHTML = items.slice(0, CONFIG.NEWS_COUNT).map(function(item) {
                var thumb = item.thumbnail || (item.enclosure && item.enclosure.link) || extractImage(item.description) || extractImage(item.content) || '';
                var imgHtml = thumb
                    ? '<img src="' + sanitize(thumb) + '" alt="" class="news-thumb" onerror="this.style.display=\'none\'">'
                    : '';
                return '<a href="' + sanitize(item.link) + '" target="_blank" rel="noopener" class="news-card fade-in">' +
                    imgHtml +
                    '<div class="news-card-text">' +
                    '<div class="news-title">' + sanitize(item.title) + '</div>' +
                    '<div class="news-meta">' +
                    '<span class="source">' + sanitize(item.author || 'News') + '</span>' +
                    '<span>' + timeAgo(item.pubDate) + '</span>' +
                    '</div></div></a>';
            }).join('');
        }

        function fetchPoliticsNews() {
            fetchNews('US politics news today', 'politics-feed', 'fetchPoliticsNews',
                'https://news.google.com/topics/CAAqIQgKIhtDQkFTRGdvSUwyMHZNRFZ4ZERBU0FoVnVBUSgBUAE');
        }

        function fetchEconomyNews() {
            fetchNews('US economy financial markets today', 'economy-feed', 'fetchEconomyNews',
                'https://news.google.com/topics/CAAqJggKIiBDQkFTRWdvSUwyMHZNR2RtZUhRU0FoVnVBUm9DUkVVb0FBUAE');
        }

        function fetchGeneralNews() {
            fetchNews('top news today USA', 'news-feed', 'fetchGeneralNews',
                'https://news.google.com/?hl=en-US&gl=US&ceid=US:en');
        }

        // ===== SPORTS =====
        async function fetchTeamData(sport, league, teamId, sectionId, bannerClass) {
            var container = document.getElementById(sectionId + '-data');

            try {
                var teamUrl = CONFIG.ESPN_BASE + '/' + sport + '/' + league + '/teams/' + teamId;
                var res = await fetch(teamUrl);
                var data = await res.json();
                var team = data.team;

                var logoUrl = team.logos && team.logos[0] ? team.logos[0].href : '';
                var record = (team.record && team.record.items && team.record.items[0]) ? team.record.items[0].summary : 'N/A';
                var standing = team.standingSummary || '';
                var displayName = team.displayName || '';

                // Next event
                var nextEventHtml = '<p style="color:#9ca3af;font-size:0.85rem;">No upcoming games scheduled</p>';
                if (team.nextEvent && team.nextEvent.length > 0) {
                    var evt = team.nextEvent[0];
                    var name = evt.shortName || evt.name || '';
                    nextEventHtml =
                        '<div class="next-game-card">' +
                        '<div class="label">Next Game</div>' +
                        '<div class="matchup">' + sanitize(name) + '</div>' +
                        '<div class="datetime">' + formatGameDate(evt.date) + ' at ' + formatGameTime(evt.date) + '</div>' +
                        '</div>';
                }

                // Recent results
                var recentHtml = '';
                try {
                    var schedRes = await fetch(teamUrl + '/schedule');
                    var schedData = await schedRes.json();
                    var events = schedData.events || [];
                    var completed = events.filter(function(e) {
                        return e.competitions && e.competitions[0] &&
                               e.competitions[0].status && e.competitions[0].status.type &&
                               e.competitions[0].status.type.completed;
                    });
                    var recent = completed.slice(-5);

                    if (recent.length > 0) {
                        recentHtml = '<div class="section-label">Recent Results</div>';
                        recentHtml += recent.map(function(event) {
                            var comp = event.competitions[0];
                            var competitors = comp.competitors || [];
                            var us = competitors.find(function(c) { return String(c.id) === String(teamId); });
                            var them = competitors.find(function(c) { return String(c.id) !== String(teamId); });
                            if (!us || !them) { us = competitors[0]; them = competitors[1]; }
                            var won = us && us.winner;
                            var ourScore = us ? (typeof us.score === 'object' ? us.score.displayValue : us.score) : '?';
                            var theirScore = them ? (typeof them.score === 'object' ? them.score.displayValue : them.score) : '?';
                            var opponentName = (them && them.team) ? (them.team.abbreviation || them.team.shortDisplayName || '?') : '?';
                            var homeAway = (us && us.homeAway === 'home') ? 'vs' : '@';
                            var dateLabel = event.date ? formatGameDate(event.date) : '';
                            return '<div class="game-item ' + (won ? 'win' : 'loss') + '">' +
                                '<div><span>' + homeAway + ' ' + sanitize(opponentName) + '</span>' +
                                '<div class="game-date-label">' + dateLabel + '</div></div>' +
                                '<span class="result ' + (won ? 'win-text' : 'loss-text') + '">' +
                                (won ? 'W' : 'L') + ' ' + ourScore + '-' + theirScore +
                                '</span></div>';
                        }).join('');
                    }
                } catch (schedErr) { /* skip */ }

                // Team news with images
                var newsHtml = '';
                try {
                    var newsRes = await fetch(CONFIG.ESPN_BASE + '/' + sport + '/' + league + '/news?team=' + teamId);
                    var newsData = await newsRes.json();
                    var articles = newsData.articles || [];

                    if (articles.length > 0) {
                        newsHtml = '<div class="section-label">Team Headlines</div>' +
                            '<div class="news-grid-1col">' +
                            articles.slice(0, 8).map(function(article) {
                                var link = (article.links && article.links.web) ? article.links.web.href : '#';
                                var imgUrl = (article.images && article.images[0]) ? article.images[0].url : '';
                                var imgHtml = imgUrl
                                    ? '<img src="' + sanitize(imgUrl) + '" alt="" class="espn-thumb" onerror="this.style.display=\'none\'">'
                                    : '';
                                return '<a href="' + sanitize(link) + '" target="_blank" rel="noopener" class="news-card">' +
                                    '<div class="espn-card">' +
                                    imgHtml +
                                    '<div class="news-card-text">' +
                                    '<div class="news-title">' + sanitize(article.headline || '') + '</div>' +
                                    '<div class="news-meta">' +
                                    '<span class="source">ESPN</span>' +
                                    '<span>' + timeAgo(article.published || '') + '</span>' +
                                    '</div></div></div></a>';
                            }).join('') +
                            '</div>';
                    }
                } catch (newsErr) { /* skip */ }

                // Build page
                container.innerHTML =
                    '<div class="fade-in">' +
                    '<div class="team-banner ' + bannerClass + '">' +
                    (logoUrl ? '<img src="' + logoUrl + '" alt="' + sanitize(displayName) + '" class="team-logo">' : '') +
                    '<div>' +
                    '<div class="team-name">' + sanitize(displayName) + '</div>' +
                    '<div class="team-record">' + sanitize(record) + '</div>' +
                    '<div class="team-standing">' + sanitize(standing) + '</div>' +
                    '</div></div>' +
                    '<div class="sports-grid">' +
                    '<div>' + nextEventHtml + recentHtml + '</div>' +
                    '<div>' + (newsHtml || '<p style="color:#9ca3af;">No recent team news</p>') + '</div>' +
                    '</div></div>';

                updateHomeQuickLook(sectionId, record, standing, team.nextEvent, logoUrl);

            } catch (e) {
                container.innerHTML =
                    '<div class="error-state">' +
                    '<p>Unable to load team data</p>' +
                    '<button onclick="fetchTeam_' + sectionId + '()">Try Again</button>' +
                    '</div>';
            }
        }

        function updateHomeQuickLook(sectionId, record, standing, nextEvent, logoUrl) {
            var target = sectionId === 'warriors' ? 'home-warriors-quick' : 'home-niners-quick';
            var el = document.getElementById(target);
            if (!el) return;

            var nextInfo = 'No upcoming games';
            if (nextEvent && nextEvent.length > 0) {
                var evt = nextEvent[0];
                nextInfo = (evt.shortName || evt.name || '') + '<br><span style="color:#6b7280;font-size:0.8rem;">' +
                    formatGameDate(evt.date) + ' at ' + formatGameTime(evt.date) + '</span>';
            }

            el.innerHTML =
                '<div class="fade-in" style="display:flex;align-items:center;gap:14px;">' +
                (logoUrl ? '<img src="' + logoUrl + '" style="width:48px;height:48px;object-fit:contain;" alt="">' : '') +
                '<div>' +
                '<div style="font-size:1.4rem;font-weight:700;">' + sanitize(record) + '</div>' +
                '<div style="font-size:0.8rem;color:#6b7280;">' + sanitize(standing) + '</div>' +
                '</div></div>' +
                '<div style="margin-top:12px;padding:10px 12px;background:#e4e6ea;border-radius:8px;font-size:0.85rem;">' +
                '<span style="font-weight:600;color:#4b5563;font-size:0.7rem;text-transform:uppercase;">Next Game</span><br>' +
                nextInfo +
                '</div>';
        }

        function fetchTeam_warriors() {
            document.getElementById('warriors-data').innerHTML = loadingHTML();
            fetchTeamData('basketball', 'nba', 9, 'warriors', 'warriors-banner');
        }

        function fetchTeam_niners() {
            document.getElementById('niners-data').innerHTML = loadingHTML();
            fetchTeamData('football', 'nfl', 25, 'niners', 'niners-banner');
        }

        // ===== REFRESH =====
        function refreshAll() {
            updateTimestamp();
            fetchPoliticsNews();
            fetchEconomyNews();
            fetchGeneralNews();
            fetchTeam_warriors();
            fetchTeam_niners();
        }

        // ===== INIT =====
        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            fetchPoliticsNews();
            fetchEconomyNews();
            fetchGeneralNews();
            fetchTeam_warriors();
            fetchTeam_niners();
            setInterval(refreshAll, CONFIG.REFRESH_INTERVAL);
        });
    </script>

</body>
</html>
